---
layout: post
title:  "WSL2. Code ubuntu trên windows - Lạc vào đồng cỏ xanh"
author: sal
lazyimages: "enabled"
categories: [ Lập trình ]
tags: [ lập trình ]
image: assets/images/laptrinh/cai-dat-linux-trong-window.webp
rating: 4.5
isGithubComments: false
permalink: lap-trinh/code-ubuntu-tren-windows
excerpt: Tại sao lại dùng WSL, Nó có lợi ích gì tới bát cơm của bạn
description: Tại sao lại dùng WSL, Nó có lợi ích gì tới bát cơm của bạn
toc: true
---

<p>Việc c&oacute; thể tận dụng sức mạnh của Windows v&agrave; Linux thật sự l&agrave; tuyệt vời, ko g&igrave; b&agrave;n c&atilde;i về việc n&agrave;y cả. Như việc Microsoft hứa sẽ support m&igrave;nh sử dụng GPU tr&ecirc;n WSL thật sự đối với với m&igrave;nh l&agrave; một điều tuyệt vời v&igrave; n&oacute; cho ph&eacute;p m&igrave;nh chạy được Tensorflow với docker v&agrave; windows lu&ocirc;n. Qu&aacute; sướng!</p><p>L&agrave; một fullstack, bạn phải đảm bảo rằng m&igrave;nh được trang bị tận răng, đụng đ&acirc;u chơi đ&oacute; đều được. H&atilde;y tưởng tượng bạn c&oacute; một ng&agrave;y buổi s&aacute;ng th&igrave; code python, build docker ầm ầm, gặp task design th&igrave; mở photoshop l&ecirc;n quất, chiều ch&eacute;m gi&oacute; kh&aacute;ch h&agrave;ng th&igrave; c&oacute; Office, tối về đi code kiếm cơm hay c&agrave;y game th&igrave; cũng ch&iacute;nh l&agrave; một con m&aacute;y đ&oacute;.</p><h3><strong>WSL rất nhanh v&agrave; nhanh hơn m&aacute;y ảo&nbsp;</strong></h3><div style="max-width: 100%">
<div class="row">
  <div class="column" style="background-color:#aaa;">
    <h2>VirtualBox</h2>
    <p>Máy ảo tạo ra một môi trường bên trong hệ thống của bạn hoạt động như một hệ thống ảo riêng biệt với tất cả các thành phần phần cứng như CPU, RAM, Bộ nhớ với sự trợ giúp của Hyper Visors. Tuy WSL2 ra đời để tối ưu GUI(Điểm khuyết thiếu của WSL1), nhưng vẫn không tốt bằng máy ảo. Vì khởi động như một hệ điều hành trong một hệ điều hành nên khởi động của VirtualBox chậm và hiệu suất không tốt. Đặc biệt, bộ nhớ của VirtualBox phải giống như 1 hệ điều hành thực thụ, có nghxia ra window 10 bạn 60GB mới chạy được thì VirtualBox cũng vậy.</p>
  </div>
  <div class="column" style="background-color:#bbb;">
    <h2>Wsl</h2>
    <p>Máy ảo có thể chạy giao diện đồ họa đầy đủ vì bản thân môi trường là một không gian làm việc Linux chính thức. Máy ảo như một BOX cô lập. Bạn không truy cập được bộ nhớ ngoài máy ảo. Còn WSl2 ra đời để làm điều này. WSl mặc định chưa có GUI, ăn rất ít ram, thường là 200-300MB. WSl2 mình không rõ bộ nhớ được quản lý thế nào, nhưng hình như nó dãn nở được và có thể thao tác từ window vào được 😎</p>
  </div>
</div>
</div><h3><strong>VS code hỗ trợ WSL tận răng v&agrave; sự ra đời của WSL2</strong></h3><p>Điều đ&oacute; nghĩa l&agrave; g&igrave;?. Điều đ&oacute; c&oacute; nghĩa l&agrave;&nbsp;Microsoft thực sự để tầm tới tầm quan trọng cho linux. Hiểu nỗi khổ khi lập tr&igrave;nh vi&ecirc;n phải dualboot window v&agrave; linux. Khi bạn muốn chạy backend nhanh mượt m&agrave; lại phải c&ugrave;ng l&uacute;c design thiết kế tr&ecirc;n c&aacute;c ứng dụng của adobe.</p><p>WSL 2 l&agrave; một phi&ecirc;n bản mới của kiến tr&uacute;c trong WSL thay đổi c&aacute;ch c&aacute;c bản ph&acirc;n phối Linux tương t&aacute;c với Windows. WSL 2 c&oacute; c&aacute;c mục ti&ecirc;u ch&iacute;nh l&agrave; tăng hiệu suất hệ thống tệp v&agrave; bổ sung khả năng tương th&iacute;ch kết nối to&agrave;n hệ thống. Mỗi bản ph&acirc;n phối Linux c&oacute; thể chạy dưới dạng WSL 1 hoặc WSL 2 v&agrave; c&oacute; thể được chuyển đổi giữa c&aacute;c phi&ecirc;n bản bất kỳ l&uacute;c n&agrave;o. WSL 2 l&agrave; một cuộc đại tu lớn của kiến tr&uacute;c cơ bản v&agrave; sử dụng c&ocirc;ng nghệ ảo h&oacute;a v&agrave; nh&acirc;n Linux để k&iacute;ch hoạt c&aacute;c t&iacute;nh năng mới của n&oacute;.</p><p>WSL 2 chỉ c&oacute; tr&ecirc;n c&aacute;c bản Windows 10, Version 2004, Build 19041 trở đi. Việc triển khai WSL2 loại bỏ được bất kỳ nhược điểm n&agrave;o m&agrave; WSL1 mắc phải khi mới ra mắt.</p><p>WSL2 thực sự l&agrave; một&nbsp;<strong>m&aacute;y ảo nhẹ</strong>&nbsp;dựa tr&ecirc;n dịch vụ ảo h&oacute;a phần cứng Hyper-V của Microsoft. WSL2 tốt hơn WSL1 như thế n&agrave;o:&nbsp;</p><ul>	<li>Một nh&acirc;n Linux thực tế</li>	<li>Khả năng cuộc gọi to&agrave;n hệ thống</li>	<li>Hiệu suất Socket/Mạng</li>	<li>Hiệu suất hệ thống tệp</li></ul><p>V&iacute; dụ, sự sẵn c&oacute; của một&nbsp;<strong>Linux Kernal</strong>&nbsp;cho ph&eacute;p người d&ugrave;ng thực thi c&aacute;c t&aacute;c vụ với khả năng tương th&iacute;ch cuộc gọi to&agrave;n hệ thống. V&igrave; vậy, nền tảng n&agrave;y trở n&ecirc;n mạnh mẽ hơn nhiều để xử l&yacute; c&aacute;c ứng dụng dựa tr&ecirc;n Linux. Ngo&agrave;i ra, c&aacute;c dịch vụ như Docker v&agrave; fuse sẽ tương th&iacute;ch.</p><p><strong>Hiệu suất tệp I/O</strong>&nbsp;được cải thiện nhiều. Do đ&oacute;, c&aacute;c thao t&aacute;c như apt-installs, npm installs sẽ nhanh hơn. Hơn nữa, đ&acirc;y l&agrave; trường hợp cho tất cả c&aacute;c dịch vụ đọc v&agrave; ghi.</p><p><em>(<strong>Ghi ch&uacute;:</strong>&nbsp;Microsoft đ&atilde; đề cập đến tốc độ tệp ch&eacute;o hệ điều h&agrave;nh chậm hơn trong c&aacute;c bản dựng ban đầu. Đơn giản l&agrave; WSL2 ngầu hơn, tốt hơn v&agrave; hỗ trợ d&agrave;i l&acirc;u hơn WSL1)</em></p><p style="text-align:center; ">
  <img src="../../assets/images/laptrinh/luu-y-wsl-2.webp" alt="Kết hợp WSl với windows"><br></p><h3><strong>WSL khiến docker chạy nhanh hơn</strong></h3><p>WSL 2 th&igrave; n&oacute; chạy linux kernel thật tr&ecirc;n HyperV lu&ocirc;n chứ k phải giả lập lại kernel. Docker c&oacute; phi&ecirc;n bản ph&aacute;t triển ri&ecirc;ng cho WSL 2 n&ecirc;n y&ecirc;n t&acirc;m, giờ l&agrave; bản preview c&oacute; thể chưa ngon nhưng c&oacute; bọn n&oacute; maintain th&igrave; sau n&agrave;y k vấn đề g&igrave;.</p><p>Khi chạy linux container với docker, Windows phải l&agrave;m một số thứ để giả lập m&ocirc;i trường linux. Điều n&agrave;y khiến việc start một container hoặc khởi động docker cũng rất &igrave; ạch.</p><p>Nhưng khi đ&atilde; c&oacute; WSL th&igrave; mọi chuyện trở n&ecirc;n dễ d&agrave;ng hơn. Docker sử dụng WSL để chạy phần engine v&agrave; UI th&igrave; vẫn chạy tr&ecirc;n windows. Điều n&agrave;y khiến cho Docker tr&ecirc;n windows nhanh hơn rất rất nhiều v&agrave; tốn &iacute;t ram hơn. 😉</p><h3><strong>D&agrave;nh cho ai chưa biết WSL l&agrave; g&igrave;</strong></h3><p>V&igrave; sao m&igrave;nh lại để phần n&agrave;y ở cuối c&ugrave;ng. V&Igrave; l&ecirc;n search mạng bạn sẽ thấy rất nhiều b&agrave;i viết về c&aacute;ch c&agrave;i đặt WSl. Nhiều bạn như m&igrave;nh tr&aacute;i ng&agrave;nh sang thậm ch&iacute; c&ograve;n chưa d&ugrave;ng ubuntu bao giờ. Sao biết khi nh&eacute;t một con th&uacute; hoang v&agrave;o một con th&uacute; hoang v&agrave;o th&igrave; sẽ c&oacute; chuyện g&igrave; xảy ra 😉</p><p>Th&ocirc;ng thường, để sử dụng c&aacute;c lệnh trong Linux, c&oacute; thể ch&uacute;ng ta sẽ phải c&agrave;i đặt Linux song song Windows hoặc sử dụng m&aacute;y ảo như VirtualBox hoặc VMware Workstation. Kể từ bản Windows 10 1607 ( build 16215) trở đi, ch&uacute;ng ta đ&atilde; c&oacute; thể chạy Linux tr&ecirc;n Windows 10 trực tiếp m&agrave; kh&ocirc;ng cần c&agrave;i đặt song song hoặc phải sử dụng m&aacute;y ảo.&nbsp;Windows Subsystem For</p><p>Linux (WSL) l&agrave; một c&ocirc;ng cụ của Microsoft để chạy Linux nguy&ecirc;n bản tr&ecirc;n Windows. N&oacute; được thiết kế để trở th&agrave;nh một trải nghiệm liền mạch, về cơ bản cung cấp một tr&igrave;nh bao Linux đầy đủ c&oacute; thể giao tiếp với hệ thống tệp Windows của bạn.</p><p>Terminal của c&aacute;c bản Ubuntu n&agrave;y cung cấp đầy đủ c&aacute;c tập lệnh để ch&uacute;ng ta quản l&yacute; tập tin, quản l&yacute; source code, compile source code, &hellip; v&agrave; rất rất nhiều c&ocirc;ng việc kh&aacute;c. Ch&uacute;ng ta c&oacute; thể sử dụng ssh, git, apt v&agrave; dpkg v&agrave; rất nhiều tools kh&aacute;c như chạy tr&ecirc;n một m&aacute;y Ubuntu server thực sự.Một số lưu &yacute; m&agrave; Microsoft liệt k&ecirc; c&oacute; thể l&agrave;m với WSL:</p><ul>	<li>Chọn sử dụng distro Linux từ Microsoft Store: Hiện giờ đang c&oacute; Ubuntu, Debian, OpenSuSe hay thậm ch&iacute; l&agrave; Kali &hellip;ch&uacute;ng đều l&agrave;&nbsp;c&aacute;c Distro Linux rất gọn nhẹ.</li>	<li>Chạy được từ d&ograve;ng lệnh c&aacute;c lệnh linux như ls, grep, sed &hellip; hoặc bất kỳ chương tr&igrave;nh nhị ph&acirc;n 64 bit (ELF-64) n&agrave;o của Linux</li>	<li>Chạy được c&aacute;c c&ocirc;ng cụ như: vim, emacs &hellip;; c&aacute;c ng&ocirc;n ngữ lập tr&igrave;nh như NodeJS, JavaScript, C/C++, C# &hellip;, c&aacute;c dịch vụ như MySQL, Apache, lighthttpd &hellip;</li>	<li>C&oacute; thể thực hiện c&agrave;i đặt c&aacute;c g&oacute;i từ tr&igrave;nh quản l&yacute; g&oacute;i của Distro đ&oacute; (như lệnh apt tr&ecirc;n Ubuntu)</li>	<li>Từ Windows c&oacute; thể chạy c&aacute;c ứng dụng Linux (d&ograve;ng lệnh)</li>	<li>Từ Linux c&oacute; thể gọi ứng dụng của Windows</li></ul><p><strong>V&igrave; đ&atilde; c&oacute; rất nhiều b&agrave;i viết về c&aacute;ch c&agrave;i đặt WSl rồi n&ecirc;n m&igrave;nh sẽ chỉ lưu &yacute; <em>một v&agrave;i điểm</em> nhỏ sau:</strong></p><ul>	<li><strong>Hyper-V feature is required</strong>&nbsp;. M&agrave; c&aacute;i feature n&agrave;y lại kh&ocirc;ng c&oacute; tr&ecirc;n Windows 10 Home. &nbsp;</li>	<li>Sử dụng SDD,CPU I5 v&agrave; ram tr&ecirc;n 16gb nh&eacute;, 8gb cần ống thở đấy 🤣</li>	<li>C&oacute; thể giới hạn số RAM, CPU với WSL</li></ul><p>Config file .wslconfig:</p><div style="background:#eeeeee; border:1px solid #cccccc; padding:5px 10px"><p><code>[wsl2] </code></p><p><code>memory=6GB </code></p><p><code>swap=2GB </code></p><p><code>localhostForwarding=true</code></p></div><p>&nbsp;</p><h3><strong>Kh&ocirc;ng n&ecirc;n chọn WSL/WSL2 khi n&agrave;o?</strong></h3><ul>	<li>Bạn y&ecirc;u cầu tất cả sức mạnh v&agrave; t&iacute;nh năng của Linux.</li>	<li>Đối với Quy m&ocirc; lớn hơn, về mặt n&agrave;y, m&aacute;y chủ linux đ&aacute;ng tin cậy hơn</li><li>GUI (Giao diện người d&ugrave;ng đồ họa)</li>	<li>Khối lượng c&ocirc;ng việc chuy&ecirc;n s&acirc;u về đồ họa hoặc mạng.</li>	<li>Kh&ocirc;ng hỗ trợ lưu dữ liệu m&aacute;y ảo tr&ecirc;n ổ đĩa kh&aacute;c ổ C. Điều n&agrave;y c&oacute; nghĩa nếu m&aacute;y bạn lỗi, cần c&agrave;i lại win th&igrave; bạn liệu m&agrave; d&ugrave;ng đĩa cứu hộ v&agrave;o ổ C m&agrave; copy file m&aacute;y ảo ra trước.</li>	<li>Kh&ocirc;ng n&ecirc;n copy file qua lại giữa WSL v&agrave; windows, tại định dạng file kh&aacute;c nhau, copy file text qua lại bọn n&oacute; kh&ocirc;ng hiểu. Nhưng copy c&aacute;c file định dạng kh&aacute;c như pdf, png, jpg c&aacute;c thứ th&igrave; thoải m&aacute;i.</li></ul><p style="text-align:center; ">
  <img src="../../assets/images/laptrinh/luu-y-wsl-1.webp" alt="WSl lỗi"><br>
</p><h3><strong>Khi n&agrave;o th&igrave; chọn WSL/WSL2?</strong></h3><ul>	<li>Th&iacute;ch&nbsp;sử dụng c&aacute;c lệnh Linux cơ bản.</li>	<li>Phần cứng hạn chế</li>	<li>Bạn cần bộ nhớ/hiệu quả lưu trữ.</li>	<li>Kh&ocirc;ng muốn đối ph&oacute; với những rắc rối của c&agrave;i đặt/quản l&yacute;/chi ph&iacute; của một m&aacute;y ảo.</li>	<li>Sức mạnh 2 hệ OS c&ugrave;ng l&uacute;c. Theo m&igrave;nh, đ&acirc;y l&agrave; c&aacute;i mang lại nhiều value c&aacute;c bạn tự trải nghiệm đi hen. Sướng th&igrave; phải tự tận hưởng th&ocirc;i. :))</li>	<li>Chạy được docker, mount volume nhanh như tr&ecirc;n Ubuntu.</li>	<li>Rẻ thay v&igrave; bạn phải mua Macbook nếu office v&agrave; terminal l&agrave; thứ ko thể thay thế.</li></ul>

<style>
*{box-sizing:border-box}.column{float:left;width:50%;padding:10px}.row:after{content:"";display:table;clear:both}@media screen and (max-width: 600px){.column{width:100%}}
