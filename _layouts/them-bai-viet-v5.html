<html>

<head>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
   <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css'>
   <meta charset="utf-8">
   <title>Thêm bài viết mới v2</title>

</head>

<body>
   <hr>
   <div>
      <section class="grid extended-grid-18">
         <div class="container clearfix">
            <div class="row row-sm-sm sample-row">
               <div class="col-xs-12 col-md-8 gutter-sm-sm gutter-margin-xs-sm">
                  <div class="inner">
                     <form id="contact-form" class="form-horizontal" role="form">

                        <div class="form-group">
                           <div class="col-sm-12">
                              <h4>Tiêu đề</h4>
                              <input type="text" class="form-control" id="titleId" placeholder="Tiêu đề"
                                 name="Tiêu đề mới" value="" onkeydown="checkInputTitleId(this);" required>
                           </div>
                        </div>

                        <div class="form-group">
                           <div class="col-sm-12">
                              <h4>Tác giả</h4>
                              <input type="text" class="form-control" id="authorId"
                                 onkeydown="checkInputAuthorId(this);" placeholder="Thêm tên tác giả" name="author-name"
                                 value="" required>
                           </div>
                        </div>
                        <h4>Nội dung</h4>
                        <textarea class="form-control" id="editor" rows="10" placeholder="Nội dung"
                           required></textarea>
                        <div class="form-group">
                           <div class="col-sm-12">
                              <h4>Chủ đề</h4>
                              <input type="text" class="form-control" id="categorieIds"
                                 onkeydown="checkInputCategoryIds(this);" placeholder="vd: nhiếp ảnh, lập trình"
                                 name="category-name" value="" required>
                           </div>
                        </div>
                        <div class="form-group">
                           <div class="col-sm-12">
                              <h4>Thẻ tag</h4>
                              <input type="text" class="form-control" id="tagIds" onkeydown="checkInputTagIds(this);"
                                 placeholder="vd: nhiếp ảnh, lập trình" name="tag-name" value="" required>
                           </div>
                        </div>
                        <br>
                        <label for="myCheck">Cho phép bình luận:</label>
                        <input type="checkbox" id="myCheck" onclick="myFunction()">
                        <br>
                        <br>
                        <button onclick="saveDynamicDataToFile();" class="btn btn-primary send-button" id="submit"
                           type="submit" value="SEND">
                           <div class="alt-send-button">
                              <i class="fa fa-paper-plane"></i><span class="send-text">Click to Save</span>
                           </div>
                        </button>
                        <!-- <center><button type="button" onclick="saveDynamicDataToFile();">Click to Save</button></center> -->
                     </form>
                     <!--
                     <center><button type="button" onclick="saveDynamicDataToFile();">Click to Save</button></center> -->
                  </div>
               </div>
               <div class="col-xs-6 col-md-4 gutter-sm-sm gutter-margin-xs-sm">
                  <div class="inner">

                     <h2>Mã code markdown</h2>
                     <hr>
                     <div id="myText"></div>
                     <p>Ctrl+A và Ctrl+S để lưu code markdown. Bạn thử dùng Ctrl+V để dán nội dung đã copy vào file md
                        của bạn.</p>
                     <hr>
                  </div>
               </div>
            </div>
         </div>
      </section>
   </div>

</body>

<script src="../ckeditor5/build/ckeditor.js"></script>
<script src="../assets/js/FileSaver.js"></script>
<script>

   let isComent = false
   let titleValue = "";
   function checkInputTitleId(obj) {
      if (obj && obj.value) {
         titleValue = obj.value;
         console.log("title: ", titleValue);
      }
   }
   let authorValue = "";
   let categoryValue = "";
   let tagValue = "";


   function checkInputCategoryIds(obj) {
      if (obj && obj.value) {
         categoryValue = obj.value;
         console.log("categoryValue: ", categoryValue);
      }
   }
   function checkInputTagIds(obj) {
      if (obj && obj.value) {
         tagValue = obj.value;
         console.log("tagValue: ", authortagValueValue);
      }
   }
   function checkInputAuthorId(obj) {
      if (obj && obj.value) {
         authorValue = obj.value;
         console.log("authorId: ", authorValue);
      }
   }

   let theEditor;
   ClassicEditor
      .create(document.querySelector('#editor')).then(editor => {
         console.log('Editor was initialized', editor);
         editor.model.document.on('change:data', () => {
            console.log(editor.getData());
            theEditor = editor.getData();
            document.getElementById('myText').innerHTML = "<pre>" + editor.getData() + "</pre>";
            // marked.parse(editor.getData());

         });
      })
      .catch(error => {
         console.error(error);
      });

   function saveDynamicDataToFile() {
      var userInput = document.getElementById("myText").value;

      // ---
      // layout: post
      // title:  "Chuyện ăn gì"
      // author: sal
      // lazyimages: "enabled"
      // categories: [ Sức khỏe ]
      // tags: [ Ăn, Đồ ăn, Dinh dưỡng ]
      // image: assets/images/thuc-pham-tot.webp
      // rating: 4.5
      // comments: true
      // ---
      let bodyContent;

      let headContent = "---\n"
      if (document.getElementById('titleId')&&document.getElementById('titleId').value) {
         console.log("document.getElementById",document.getElementById('titleId').value);
         headContent = headContent + "title: \"" + document.getElementById('titleId').value + "\"\n"
      }
      if (document.getElementById('authorId')&&document.getElementById('authorId').value) {
         console.log("document.getElementById");
         headContent = headContent + "author: \"" + document.getElementById('authorId').value + "\"\n"
      }
      if (document.getElementById('categorieIds')&&document.getElementById('categorieIds').value) {
         console.log("document.getElementById");
         headContent = "categories: [ " + document.getElementById('categorieIds').value + " ]\n"
      }

      headContent = headContent + "---\n\n\n"

      bodyContent = headContent + theEditor
      console.log(bodyContent);
      var blob = new Blob([theEditor], { type: "text/plain;charset=utf-8" });
      saveAs(blob, "dynamic.md");
   }

   // function myFunction() {
   //    var copyText = document.getElementById("myText").innerHTML;
   //    window.prompt("Copy to clipboard: Ctrl+C, Enter", copyText);

   //    var tooltip = document.getElementById("myTooltip");
   //    tooltip.style.display = 'block';
   //    tooltip.innerHTML = "Đã copy";
   // }
   function myFunction() {
      var checkBox = document.getElementById("myCheck");
      var text = document.getElementById("text");
      if (checkBox.checked == true) {
         text.style.display = "block";
      } else {
         text.style.display = "none";
      }
   }
   // function readTextFile(file) {
   //    console.log("readfile");
   //    var rawFile = new XMLHttpRequest();
   //    rawFile.open("GET", file, false);
   //    rawFile.onreadystatechange = function () {
   //       if (rawFile.readyState === 4) {
   //          if (rawFile.status === 200 || rawFile.status == 0) {
   //             var allText = rawFile.responseText;
   //             alert(allText);
   //          }
   //       }
   //    }
   //    rawFile.send(null);
   // }
   // readTextFile("file:///C:/your/path/to/file.txt");


</script>


</html>
